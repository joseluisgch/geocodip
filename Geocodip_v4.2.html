<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEOPORTAL CODIP - An치lisis Urbano</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="styles.css" />

</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo-container">
                <img src="https://codip.pe/wp-content/uploads/2025/06/CODIP_LogoMocha-1.svg" alt="CODIP" class="logo">
            </div>
            <div class="header-title">
                <h1>AN츼LISIS URBANO</h1>
                <p class="subtitle">M칩dulo de priorizaci칩n multicriterio</p>
            </div>
        </div>
        <div class="header-right">
            <button class="header-btn" id="btn-layers">
                <i class="fas fa-layer-group"></i>
                <span>Capas</span>
            </button>
            <button class="header-btn" id="btn-scenarios">
                <i class="fas fa-save"></i>
                <span>Guardar Escenario</span>
            </button>
            <div class="user-menu">
                <div class="user-avatar">U</div>
                <span class="user-name">Anonimo</span>
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
    </header>

    <!-- Panel lateral izquierdo -->
    <aside class="sidebar-left" id="sidebarLeft">
        <div class="sidebar-header">
            <h2>Panel de ponderaciones</h2>
        </div>

        <div class="sidebar-content">
            <!-- Resumen de Variables Activas - NUEVO -->
            <div id="variables-summary" class="variables-summary" style="display: none;">
                <div class="summary-title">游늵 Variables del Escenario</div>
                <div id="summary-content"></div>
            </div>
            
            <div id="variable-controls"></div>
            <div id="analysis-messages"></div>
        </div>

        <div class="sidebar-footer">
            <div class="total-weight-container">
                <div id="total-weight" class="total-weight">Total: 0%</div>
            </div>

            <div class="action-buttons">
                <button id="calculate-btn" class="btn btn-primary" disabled>
                    <i class="fas fa-calculator"></i> Calcular Aptitud
                </button>
                <button id="reset-btn" class="btn btn-secondary">
                    <i class="fas fa-undo"></i> Reiniciar
                </button>
            </div>
        </div>
    </aside>

    <!-- Mapa principal -->
    <main class="map-container">
        <div id="map"></div>

        <div class="map-controls">
            <button class="map-control-btn" id="zoom-in">
                <i class="fas fa-plus"></i>
            </button>
            <button class="map-control-btn" id="zoom-out">
                <i class="fas fa-minus"></i>
            </button>
        </div>

        <!-- Control de aptitud - COLAPSABLE -->
        <div class="aptitude-control" id="aptitudeControl">
            <div class="aptitude-header" id="aptitudeHeader">
                <h4><i class="fas fa-sliders-h"></i> Capa de Aptitud</h4>
                <button class="aptitude-collapse-btn" id="aptitudeCollapseBtn">
                    <i class="fas fa-chevron-up"></i>
                </button>
            </div>
            <div class="aptitude-body">
                <div class="aptitude-toggle">
                    <input type="checkbox" id="aptitude-visibility" checked>
                    <label for="aptitude-visibility">Mostrar capa</label>
                </div>
                <div class="opacity-control">
                    <div class="opacity-label">
                        <span>Transparencia</span>
                        <span id="opacity-value">60%</span>
                    </div>
                    <input type="range" class="opacity-slider" id="aptitude-opacity" 
                           min="0" max="100" value="60">
                </div>
            </div>
        </div>

        <div class="base-layer-control">
            <div class="base-layer-btn active" data-layer="dark">
                <i class="fas fa-moon"></i> Dark
            </div>
            <div class="base-layer-btn" data-layer="osm">
                <i class="fas fa-map"></i> OpenStreetMap
            </div>
            <div class="base-layer-btn" data-layer="satellite">
                <i class="fas fa-satellite"></i> Sat칠lite
            </div>
        </div>

        <div id="legend" class="legend" style="display: none;">
            <div class="legend-header" id="legendHeader">
                <h4>Leyenda</h4>
                <button class="legend-collapse-btn" id="legendCollapseBtn">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div class="legend-body">
                <div id="legend-content"></div>
            </div>
        </div>
    </main>

    <!-- Panel lateral derecho -->
    <aside class="sidebar-right" id="sidebarRight">
        <div class="sidebar-header">
            <h2><i class="fas fa-chart-line"></i> Indicadores</h2>
        </div>

        <div class="sidebar-content">
            <div class="info-card">
                <h3>Hex치gono seleccionado</h3>
                <div id="hexagon-info">
                    <p class="no-selection">Pase el cursor sobre un hex치gono para ver informaci칩n</p>
                </div>
            </div>

            <div class="info-card">
                <h3>Contribuci칩n de Variables</h3>
                <!-- Pesta침as del Radar - NUEVO -->
                <div class="radar-tabs">
                    <button class="radar-tab active" data-mode="all">Todas las Variables</button>
                    <button class="radar-tab" data-mode="scenario">Variables del Escenario</button>
                </div>
                <div id="radar-container">
                    <canvas id="radarCanvas" width="280" height="280"></canvas>
                </div>
                <div id="radar-info" style="font-size: 11px; color: var(--text-secondary); text-align: center; margin-top: 10px; padding: 8px; background: rgba(255, 255, 255, 0.02); border-radius: 6px; border: 1px solid var(--border-color);">
                    Contribuci칩n de cada variable a la aptitud total del hex치gono
                </div>
            </div>

            <div class="info-card">
                <h3>Ranking de Distritos</h3>
                <div id="district-ranking">
                    <p class="no-data">Calcule la aptitud para ver resultados</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Modal de capas -->
    <div class="modal" id="layersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Capas Geogr치ficas</h2>
                <button class="close-btn" id="closeLayersModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="layer-container">
                    <div class="loading">Cargando capas...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="script.js"></script>

</body>
</html>